---
import { getChannels } from '../../data/channels.js';
import VideoPlayer from '../../components/VideoPlayer.jsx';

export async function getStaticPaths() {
  const channels = await getChannels();
  return channels.map(channel => ({
    params: { id: channel.id },
    props: { channel }
  }));
}

const { channel } = Astro.props;
---

<html lang="id">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{channel.name} - Sedang Tayang di StreamID</title>
		<!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
		
		<style>
			:root {
				--bg-main: #06090f;
				--bg-card: #0d1117;
				--accent: #38bdf8;
				--accent-glow: rgba(56, 189, 248, 0.4);
				--text-primary: #f8fafc;
				--text-secondary: #94a3b8;
				--border: rgba(255, 255, 255, 0.08);
				--glass: rgba(15, 23, 42, 0.7);
				--danger: #ef4444;
				--success: #22c55e;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				background-color: var(--bg-main);
				color: var(--text-primary);
				font-family: 'Inter', system-ui, -apple-system, sans-serif;
				line-height: 1.5;
				min-height: 100vh;
				overflow-x: hidden;
			}

			.glass {
				background: var(--glass);
				backdrop-filter: blur(12px);
				-webkit-backdrop-filter: blur(12px);
				border: 1px solid var(--border);
			}

			/* Header */
			header {
				height: 70px;
				background: rgba(6, 9, 15, 0.8);
				border-bottom: 1px solid var(--border);
				backdrop-filter: blur(10px);
				position: sticky;
				top: 0;
				z-index: 100;
			}

			.container {
				max-width: 1440px;
				margin: 0 auto;
				padding: 0 2rem;
			}

			.nav-content {
				height: 100%;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.back-btn {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				color: var(--text-secondary);
				text-decoration: none;
				font-weight: 600;
				font-size: 0.9rem;
				transition: all 0.2s ease;
				padding: 0.5rem 1rem;
				border-radius: 12px;
				background: var(--border);
			}

			.back-btn:hover {
				color: var(--text-primary);
				background: rgba(255, 255, 255, 0.1);
				transform: translateX(-4px);
			}

			.channel-status {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				background: rgba(34, 197, 94, 0.1);
				padding: 0.4rem 1rem;
				border-radius: 100px;
				border: 1px solid rgba(34, 197, 94, 0.2);
				color: var(--success);
				font-weight: 700;
				font-size: 0.75rem;
				letter-spacing: 1px;
			}

			.dot {
				width: 8px;
				height: 8px;
				background: var(--success);
				border-radius: 50%;
				box-shadow: 0 0 12px var(--success);
				animation: pulse 1.5s infinite;
			}

			@keyframes pulse {
				50% { opacity: 0.5; transform: scale(0.8); }
			}

			/* Main Content */
			main {
				padding: 2rem 0 4rem;
			}

			.player-layout {
				display: grid;
				grid-template-columns: 1fr 380px;
				gap: 2rem;
			}

			/* Video Player Container */
			.player-container {
				background: #000;
				border-radius: 24px;
				overflow: hidden;
				aspect-ratio: 16 / 9;
				border: 1px solid var(--border);
				box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
				position: relative;
			}

			.video-inner {
				width: 100%;
				height: 100%;
			}

			/* Sidebar */
			.sidebar {
				display: flex;
				flex-direction: column;
				gap: 1.5rem;
			}

			.card {
				padding: 1.75rem;
				border-radius: 24px;
			}

			.channel-info-card {
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
			}

			.logo-box {
				width: 100px;
				height: 100px;
				background: rgba(0, 0, 0, 0.3);
				border-radius: 20px;
				padding: 1rem;
				margin-bottom: 1.5rem;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.logo-img {
				width: 100%;
				height: 100%;
				object-fit: contain;
			}

			.channel-title {
				font-family: 'Outfit', sans-serif;
				font-size: 1.75rem;
				font-weight: 800;
				margin-bottom: 0.5rem;
			}

			.channel-meta {
				display: flex;
				gap: 1rem;
				font-size: 0.85rem;
				color: var(--text-secondary);
				margin-bottom: 1.5rem;
			}

			.badge {
				background: var(--border);
				padding: 0.25rem 0.75rem;
				border-radius: 6px;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.action-btn {
				width: 100%;
				padding: 1rem;
				background: var(--accent);
				color: var(--bg-main);
				border: none;
				border-radius: 16px;
				font-weight: 700;
				cursor: pointer;
				transition: all 0.2s ease;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 0.5rem;
			}

			.action-btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 20px var(--accent-glow);
				filter: brightness(1.1);
			}

			/* Tips Card */
			.tips-card h3 {
				font-family: 'Outfit', sans-serif;
				font-size: 1.1rem;
				margin-bottom: 1rem;
				color: var(--accent);
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.tips-list {
				list-style: none;
				font-size: 0.85rem;
				color: var(--text-secondary);
			}

			.tips-list li {
				margin-bottom: 0.75rem;
				padding-left: 1.25rem;
				position: relative;
			}

			.tips-list li::before {
				content: '‚Ä¢';
				position: absolute;
				left: 0;
				color: var(--accent);
			}

			/* Mixed Content Alert */
			.alert-box {
				padding: 1.25rem;
				border-radius: 20px;
				background: rgba(239, 68, 68, 0.1);
				border: 1px solid rgba(239, 68, 68, 0.2);
				color: var(--danger);
				font-size: 0.85rem;
				margin-top: 1rem;
			}

			.alert-box strong {
				display: block;
				margin-bottom: 0.25rem;
				font-weight: 700;
			}

			/* Responsive */
			@media (max-width: 1200px) {
				.player-layout { grid-template-columns: 1fr; }
				.sidebar { display: grid; grid-template-columns: 1fr 1fr; }
				.alert-box { grid-column: 1 / -1; }
			}

			@media (max-width: 768px) {
				.container { padding: 0 1.5rem; }
				.sidebar { grid-template-columns: 1fr; }
				.player-container { border-radius: 16px; }
				.channel-title { font-size: 1.5rem; }
			}

			@media (max-width: 480px) {
				header { height: 60px; }
				.back-btn span { display: none; }
				.nav-content { justify-content: space-between; }
			}
		</style>
	</head>
	<body>
		<!-- Header -->
		<header>
			<div class="container nav-content">
				<a href="/" class="back-btn">
					<span>‚Üê</span> <span>Beranda</span>
				</a>
				<div class="channel-status">
					<span class="dot"></span>
					Bersiaran Langsung
				</div>
			</div>
		</header>

		<main class="container">
			<div class="player-layout">
				<!-- Player Section -->
				<section class="player-section">
					<div class="player-container">
						<VideoPlayer url={channel.url} client:load />
					</div>
					
					{channel.url?.startsWith('http://') && (
						<div class="alert-box">
							<strong>‚ö†Ô∏è Masalah Keamanan Browser (Mixed Content)</strong>
							Saluran ini menggunakan koneksi belum terenkripsi (HTTP). Jika stream tidak muncul, silakan tekan tombol gembok di browser dan izinkan "Insecure Content" atau "Allow insecure content".
						</div>
					)}
				</section>

				<!-- Info Sidebar -->
				<aside class="sidebar">
					<div class="card glass channel-info-card">
						<div class="logo-box">
							{channel.logo ? (
								<img src={channel.logo} alt={channel.name} class="logo-img" onerror="this.src='https://via.placeholder.com/100?text=TV'" />
							) : (
								<span style="font-size: 3rem;">üì∫</span>
							)}
						</div>
						<h1 class="channel-title">{channel.name}</h1>
						<div class="channel-meta">
							<span class="badge">{channel.group}</span>
							<span class="badge">INDONESIA</span>
						</div>
						<button class="action-btn" onclick="window.location.reload()">
							<span>üîÑ</span> Muat Ulang Siaran
						</button>
					</div>

					<div class="card glass tips-card">
						<h3>üí° Tips Streaming</h3>
						<ul class="tips-list">
							<li>Jika layar hitam, tunggu 5-10 detik untuk inisialisasi buffer.</li>
							<li>Kualitas gambar otomatis menyesuaikan kecepatan internet Anda.</li>
							<li>Gunakan Google Chrome atau Safari versi terbaru untuk pengalaman terbaik.</li>
							<li>Klik kanan pada video untuk opsi tambahan (jika tersedia).</li>
						</ul>
					</div>
				</aside>
			</div>
		</main>

		<footer style="text-align: center; padding: 2rem; color: var(--text-secondary); font-size: 0.8rem; border-top: 1px solid var(--border);">
			StreamID Modern Player ‚Ä¢ 2026 ‚Ä¢ Dirancang untuk Kecepatan
		</footer>
	</body>
</html>
