---
import Sidebar from '../components/layout/Sidebar.jsx';
import Header from '../components/layout/Header.jsx';
import Footer from '../components/layout/Footer.jsx';
import Disclaimer from '../components/Disclaimer.jsx';
import SupportBot from '../components/SupportBot.jsx';

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="/logo.png" />
		<meta name="generator" content={Astro.generator} />
		<title>{title} | StreamID</title>
		
		<!-- PWA & Mobile Meta -->
		<link rel="manifest" href="/manifest.webmanifest" />
		<meta name="theme-color" content="#e11d48" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="apple-mobile-web-app-title" content="StreamID" />
		<link rel="apple-touch-icon" href="/logo.png" />

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">

	</head>
	<body>
		<div class="app-layout">
			<Disclaimer client:load />
			<Sidebar client:load />
			<div class="main-content">
				<Header client:load />
				<main class="content-body">
					<slot />
                    
                    {/* Banner Ad 468x60 */}
                    <div style="display: flex; justify-content: center; margin: 2rem 0; clear: both;">
                        <script is:inline type="text/javascript">
                            atOptions = {
                                'key' : '362ef147da7bb1ad306e7031647ae70a',
                                'format' : 'iframe',
                                'height' : 60,
                                'width' : 468,
                                'params' : {}
                            };
                        </script>
                        <script is:inline type="text/javascript" src="https://www.highperformanceformat.com/362ef147da7bb1ad306e7031647ae70a/invoke.js"></script>
                    </div>

                    <Footer client:visible />
				</main>
			</div>
			<SupportBot client:load />
		</div>

		<script>
			import { requestPersistence } from '../utils/persistence';
			// PWA Service Worker Registration
			import { registerSW } from 'virtual:pwa-register';
            import { trackPageView } from '../lib/analytics';

			// Request persistence on mount
			requestPersistence();
            
            // Track page view
            trackPageView();

			if ('serviceWorker' in navigator) {
				registerSW({
					immediate: true,
					onNeedRefresh() {
						console.log('New content available, reload to update.');
					},
					onOfflineReady() {
						console.log('App is ready to work offline.');
					},
				});
			}
		</script>
        
        {/* EffectiveGate CPM Ad */}
        <script is:inline src="https://pl28629367.effectivegatecpm.com/83/40/40/834040448f909961d91352ac2758f21f.js"></script>
	</body>
</html>

<style is:global>
	:root {
		--bg-app: #0f1115;
		--bg-surface: #1a1d23;
		--accent: #e11d48;
		--text-primary: #ffffff;
		--text-secondary: #94a3b8;
		--border: rgba(255, 255, 255, 0.05);
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	body {
		background-color: var(--bg-app);
		color: var(--text-primary);
		font-family: 'Inter', system-ui, -apple-system, sans-serif;
		overflow-x: hidden;
	}

	.app-layout {
		display: flex;
		min-height: 100vh;
	}

	.main-content {
		flex: 1;
		margin-left: 240px;
		display: flex;
		flex-direction: column;
		min-width: 0;
	}

	.content-body {
		padding: 0 2rem 4rem;
		flex: 1;
	}

	@media (max-width: 1024px) {
		.main-content {
			margin-left: 80px;
		}
	}
	
	@media (max-width: 768px) {
		.main-content {
			margin-left: 0;
		}
		.content-body {
			padding: 0 1rem 6rem; /* Extra padding for bottom nav */
		}
	}

	@media (max-width: 640px) {
		.content-body {
			padding: 0 1rem 6rem;
		}
	}

	/* Scrollbar */
	::-webkit-scrollbar {
		width: 8px;
	}

	::-webkit-scrollbar-track {
		background: transparent;
	}

	::-webkit-scrollbar-thumb {
		background: rgba(255, 255, 255, 0.1);
		border-radius: 10px;
	}

	::-webkit-scrollbar-thumb:hover {
		background: rgba(255, 255, 255, 0.2);
	}
</style>
