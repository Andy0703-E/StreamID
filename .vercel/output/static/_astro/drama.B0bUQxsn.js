const t="https://api.sansekai.my.id/api";async function a(a){const e=`drama_v2_${a}`;if("undefined"!=typeof window)try{const t=localStorage.getItem(e);if(t){const{data:a,timestamp:e}=JSON.parse(t);if(Date.now()-e<6e5)return a}}catch(o){}try{const i=await fetch(`${t}${a}`,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}});if(!i.ok)throw new Error(`API Error: ${i.status}`);const r=await i.json(),n=t=>({id:t.bookId||t.id||"",title:t.bookName||t.title||t.name||"Unknown Drama",poster:t.bookCover||t.coverWap||t.poster||t.image||"",episode:t.chapterCount||t.episode||t.latest_episode||"",rating:t.rating||t.rankVo?.hotCode||0,description:t.introduction||t.description||t.synopsis||"",tags:t.tags||[],playCount:t.playCount||"",videoPath:t.videoPath||""}),d=Array.isArray(r)?r.map(n):r.data?r.data.map(n):n(r);if("undefined"!=typeof window)try{localStorage.setItem(e,JSON.stringify({data:d,timestamp:Date.now()}))}catch(o){}return d}catch(i){return null}}const e={getTrending:(t=1)=>a(`/dramabox/trending?page=${t}`),getLatest:(t=1)=>a(`/dramabox/latest?page=${t}`),getForYou:()=>a("/dramabox/foryou"),getRandom:()=>a("/dramabox/randomdrama"),getDetail:t=>a(`/dramabox/detail?bookId=${t}`),getEpisodes:async a=>{try{const e=await fetch(`${t}/dramabox/allepisode?bookId=${a}`);if(!e.ok)return[];const o=await e.json();let i=[];return Array.isArray(o)?i=o:o&&Array.isArray(o.data)&&(i=o.data),i.map((t,a)=>{let e="",o=t.cdnList?.find(t=>t.cdnDomain?.includes("hwztakavideo"));if(o||(o=t.cdnList?.find(t=>1===t.isDefault)),o||(o=t.cdnList?.[0]),o){const t=o.videoPathList?.find(t=>1===t.isDefault)||o.videoPathList?.find(t=>720===t.quality)||o.videoPathList?.[0];e=t?.videoPath||""}return e||(e=t.videoPath||t.url||""),{id:t.chapterId||`ep_${a}`,index:t.chapterIndex||a,title:t.chapterName||`Episode ${a+1}`,url:e,poster:t.chapterImg||t.cover||""}})}catch(e){return[]}},search:t=>a(`/dramabox/search?q=${t}`)};export{e as dramaService};
